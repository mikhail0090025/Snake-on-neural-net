<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake on neural net</title>
    <script src="NeuralNet.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
</head>
<body>
    <h3>Snake on neural net</h3>
    <canvas id="game_canv" width="600px" height="600px"></canvas>
    <div id="control-block">
        <button class="btn btn-primary" onclick="StepNN(0);">Neural netÂ´s step</button>
        <p>Gray - playing zone.<br>Black - not playing zone.</p>
    </div>
    <div id="gen_data">
        <h3>Neural net generation parameter</h3>
        <p>{{ generation.size(); }}</p>
    </div>
    <!-- Game JS script -->
    <script src="Game.js"></script>

    <script>
        let gen_size = 50;
        var gen = new Generation(12, 4, 30, 6, gen_size, RoundMethod.DontRound, RoundMethod.ZeroAndOne, RoundMethod.Tanh);
        console.log(gen);
        let playing = true;
        let steps = 0;
        for (let i = 0; i < gen_size; i++) {
            steps = 0;
            while (playing) {
                StepNN(i);
                steps++;
                if(steps > 10000){
                    gen.Generation_[i].ChangeScore(-100);
                    console.log("Player " + i + " got into cycle(((");
                    break;
                }
            }
            playing = true;
        }
        alert(gen.BestNet().Score());
        function StepNN(index) {
            gen.Generation_[index].GetInputs(game.StateForNeuralNet());
            let res = gen.Generation_[index].Result();
            let step = res.indexOf(Math.max(...res));
            let step_result = game.Step(step, true);
            switch (step_result) {
                case 0:
                    gen.Generation_[index].ChangeScore(0.1);
                    break;
                case 1:
                    console.log(index + " played, and has score " + gen.Generation_[index].Score());
                    playing = false;
                    break;
                case 2:
                    gen.Generation_[index].ChangeScore(30);
                    break;
                default:
                    throw new Error("Unknown step result!");
                    break;
            }
        }
        // View of generation
        new Vue({
            el: "#gen_data",
            data: {
                generation: gen
            },
            methods: {

            }
        });
    </script>
</body>
</html>